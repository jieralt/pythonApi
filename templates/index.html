<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>任务树</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            padding: 20px;
        }
        .task-item {
            margin-bottom: 10px;
        }
        .task-content {
            display: flex;
            align-items: center;
        }
        .task-content input[type="text"] {
            margin-right: 10px;
        }
        .subtasks {
            margin-left: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>任务树</h2>
        <div id="taskTree" class="mb-4">
            <!-- 任务树将在这里生成 -->
        </div>
        <button class="btn btn-primary" onclick="addTask()">添加任务</button>
    </div>

    <script>
        let taskIdCounter = 0;

        function createTaskElement(taskId, taskContent = '', taskDescription = '', taskCompleted = false) {
            const taskElement = document.createElement('div');
            taskElement.className = 'task-item';
            taskElement.id = `task-${taskId}`;

            const taskContentElement = document.createElement('div');
            taskContentElement.className = 'task-content';

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.checked = taskCompleted;
            checkbox.className = 'mr-2';

            const taskInput = document.createElement('input');
            taskInput.type = 'text';
            taskInput.value = taskContent;
            taskInput.className = 'form-control d-inline-block';
            taskInput.style.width = '20%';

            const taskDescriptionInput = document.createElement('input');
            taskDescriptionInput.type = 'text';
            taskDescriptionInput.value = taskDescription;
            taskDescriptionInput.className = 'form-control d-inline-block ml-2';
            taskDescriptionInput.style.width = '40%';

            const addButton = document.createElement('button');
            addButton.className = 'btn btn-success btn-sm ml-2';
            addButton.textContent = '添加子任务';
            addButton.onclick = () => addSubTask(taskId);

            const deleteButton = document.createElement('button');
            deleteButton.className = 'btn btn-danger btn-sm ml-2';
            deleteButton.textContent = '删除';
            deleteButton.onclick = () => deleteTask(taskId);

            const toggleButton = document.createElement('button');
            toggleButton.className = 'btn btn-info btn-sm ml-2';
            toggleButton.textContent = '折叠';
            toggleButton.onclick = () => toggleSubTasks(taskId);

            taskContentElement.appendChild(checkbox);
            taskContentElement.appendChild(taskInput);
            taskContentElement.appendChild(taskDescriptionInput);
            taskContentElement.appendChild(addButton);
            taskContentElement.appendChild(deleteButton);
            taskContentElement.appendChild(toggleButton);

            const subTaskContainer = document.createElement('div');
            subTaskContainer.className = 'subtasks';
            subTaskContainer.id = `subtasks-${taskId}`;

            taskElement.appendChild(taskContentElement);
            taskElement.appendChild(subTaskContainer);

            return taskElement;
        }

        function addTask() {
            const taskId = taskIdCounter++;
            const taskTree = document.getElementById('taskTree');
            const taskElement = createTaskElement(taskId);
            taskTree.appendChild(taskElement);
        }

        function addSubTask(parentTaskId) {
            const taskId = taskIdCounter++;
            const subTaskContainer = document.getElementById(`subtasks-${parentTaskId}`);
            const taskElement = createTaskElement(taskId);
            subTaskContainer.appendChild(taskElement);
        }

        function deleteTask(taskId) {
            const taskElement = document.getElementById(`task-${taskId}`);
            taskElement.remove();
        }

        function toggleSubTasks(taskId) {
            const subTaskContainer = document.getElementById(`subtasks-${taskId}`);
            const isHidden = subTaskContainer.style.display === 'none';
            subTaskContainer.style.display = isHidden ? 'block' : 'none';
        }
    </script>
</body>
</html>
